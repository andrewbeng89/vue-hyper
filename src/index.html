<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>
  <link href="main.css" rel="stylesheet">
</head>
<body>
  <my-component></my-component>
  <script type="module">
    import { html } from "https://unpkg.com/uhtml?module";
    import { reactive, readonly } from "https://unpkg.com/@vue/reactivity/dist/reactivity.esm-browser.js";
    import { createStore } from "https://gitcdn.link/repo/andrewbeng89/staex/main/dist/index.js";
    import { defineComponent, mounted, updated } from "./index.js";
    import { defineUiInput } from "./ui-components.js";

    const useStore = createStore({ reactive, readonly });
    const store = useStore({
      state: {
        text: ""
      },
      actions: {
        setText: (state, text) => {
          state.text = text;
        }
      }
    });

    defineUiInput();

    defineComponent(
      "my-display",
      ({ props }) => () => html`
        <p>${props.message}</p>
      `,
      {
        propDefs: ["message"]
      }
    );

    defineComponent("my-component", ({ ctx }) => {
    
      const onInput = ({ detail }) => {
        const { value } = detail;
        store.dispatch("setText", value);
      };

      const listeners = {
        input: onInput
      };

      mounted(() => {
        console.log("mounted...");
      });

      updated(() => {
        console.log(store.state.text);
      });

      return () => html`
        <p>
          <ui-input
            label="Welcome message"
            value=${store.state.text}
            oninput.native=${onInput}
          />
        </p>
        <my-display message=${store.state.text}></my-display>
      `
    })
  </script>
</body>
</html>