<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>
</head>
<body>
  <!-- vue-hyper -->
  <my-component></my-component>
  
  <!-- Web Component -->
  <ui-input id="myInput" label="Custom Input"></ui-input>
  
  <!-- Vue -->
  <div id="vueApp" class="ce-mt-4">
    <my-input class="ce-p-4"></my-input>
  </div>

  <!-- React -->
  <div id="reactApp" class="ce-mt-4"></div>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12/dist/vue.js"></script>
  <script>
    // Web Component
    const myInput = document.querySelector("#myInput");
    myInput.addEventListener("input", console.log);
    var onInput = console.log;

    // Vue
    Vue.config.ignoredElements = ["ui-input"];
    Vue.component("my-input", {
      template: `
        <ui-input
          :value="inputValue"
          @input="onInput"
          label="My Vue Input"
        />
      `,
      methods: {
        onInput({ target }) {
          this.inputValue = target.value;
        }
      },
      data() {
        return {
          inputValue: ""
        };
      }
    });

    const vueApp = new Vue({
      el: "#vueApp"
    });
  </script>
  <script type="module">
    import { html, render } from "https://unpkg.com/htm/preact/standalone.mjs";
    import { createStore } from "https://gitcdn.link/repo/andrewbeng89/staex/main/dist/index.js";
    import { reactive, readonly } from "./index.js";

    const useStore = createStore({ reactive, readonly });
    
    const state = {
      inputValue: "Hello, world!"
    };
    const actions = {
      setInputValue: (state, inputValue) => {
        state.inputValue = inputValue;
      }
    };
    const store = useStore({ state, actions });

    const App = () => {
      return html`
        <ui-input
          label="My Preact Input"
          value=${store.state.inputValue}
          onInput=${({ target }) => store.dispatch("setInputValue", target.value)}
        />
      `;
    }

    const domContainer = document.querySelector("#reactApp");
    render(html`<${App} />`, domContainer);
  </script>
  <script type="module">
    import { createStore } from "https://gitcdn.link/repo/andrewbeng89/staex/main/dist/index.js";
    import { defineComponent, mounted, updated, html, reactive, readonly } from "./index.js";
    import { defineUiInput, defineUiDialog } from "./ui-components.js";

    const useStore = createStore({ reactive, readonly });
    const store = useStore({
      state: {
        text: "Hello, world!",
        isDialogOpen: false
      },
      actions: {
        setText: (state, text) => {
          state.text = text;
        },
        openDialog: state => {
          state.isDialogOpen = true;
        },
        closeDialog: state => {
          state.isDialogOpen = false;
        }
      }
    });

    defineUiInput();
    defineUiDialog();

    defineComponent({
      name: "my-display",
      setup: ({ props }) => () => html`
        <pre>message: ${props.message}</pre>
      `,
      propDefs: ["message"]
    });

    defineComponent({
      name: "my-component",
      
      setup: ({ ctx }) => {
    
        const onInput = ({ detail }) => {
          const { value } = detail;
          store.dispatch("setText", value);
        };

        const listeners = {
          input: onInput
        };

        mounted(() => {
          console.log("mounted...");
        });

        updated(() => {
          console.log(store.state);
        });

        return () => html`
          <pre>Rusable UI custom elements</pre>
          <p>
            <ui-input
              label="Welcome message"
              value=${store.state.text}
              oninput.native=${onInput}
              onkeyup.native=${({ detail }) => console.log(detail)}
            />
          </p>
          ${
            store.state.text
              ? html`
                <my-display message=${store.state.text}></my-display>
              `
              : ""
          }
          <button onclick=${() => store.dispatch("openDialog")}>
            Open dialog
          </button>
          ${
            store.state.isDialogOpen ? html`
              <ui-dialog onclose.native=${() => store.dispatch("closeDialog")}>
                <span slot="header">Dialog header</span>
                Dialog content
                <span slot="footer">Dialog footer</span>
              </ui-dialog>
            ` : ""
          }
          <pre>isDialogOpen: ${store.state.isDialogOpen}</pre>
        `
      }
    })
  </script>
</body>
</html>